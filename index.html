<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ETH Strategy Hub - Sync Pro</title>
    <style>
        :root { --primary: #38bdf8; --bg: #0f172a; --card: #1e293b; --text: #f8fafc; --low: #4ade80; --mid: #facc15; --high: #f87171; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); padding: 15px; display: flex; justify-content: center; }
        .card { background: var(--card); padding: 25px; border-radius: 16px; width: 100%; max-width: 480px; box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; background: #334155; padding: 5px; border-radius: 10px; }
        .tab-btn { flex: 1; padding: 10px; border: none; border-radius: 8px; background: none; color: #94a3b8; cursor: pointer; font-weight: 600; transition: 0.3s; }
        .tab-btn.active { background: var(--primary); color: var(--bg); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-size: 0.85em; color: #94a3b8; }
        input { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #475569; background: var(--bg); color: #fff; box-sizing: border-box; }
        .result-box { margin-top: 20px; padding: 15px; border-radius: 12px; background: #334155; border-left: 5px solid var(--primary); }
        .highlight { color: var(--primary); font-weight: bold; font-size: 1.3em; display: block; }
        .badge { display: inline-block; padding: 8px 15px; border-radius: 20px; font-weight: bold; margin-top: 10px; font-size: 0.85em; width: 100%; text-align: center; box-sizing: border-box; }
        .badge-green { background: rgba(74, 222, 128, 0.15); color: #4ade80; border: 1px solid #4ade80; }
        .badge-yellow { background: rgba(250, 204, 21, 0.15); color: #facc15; border: 1px solid #facc15; }
        .badge-red { background: rgba(248, 113, 113, 0.15); color: #f87171; border: 1px solid #f87171; }
    </style>
</head>
<body>

<div class="card">
    <div class="tabs">
        <button class="tab-btn active" onclick="openTab('strikes')">Calcular Strikes</button>
        <button class="tab-btn" onclick="openTab('risk')">Analizar Dual</button>
    </div>

    <div class="input-group"><label>Precio Spot (USD)</label><input type="number" class="sync-s" value="1950" oninput="syncValues(this, 's')"></div>
    <div class="input-group"><label>IV Semanal (%)</label><input type="number" class="sync-iv" value="129" oninput="syncValues(this, 'iv')"></div>
    <div class="input-group"><label>DTE (Días para Expiración)</label><input type="number" class="sync-dte" value="7" oninput="syncValues(this, 'dte')"></div>

    <hr style="border: 0; border-top: 1px solid #334155; margin: 20px 0;">

    <div id="strikes" class="tab-content active">
        <div class="input-group"><label>Z-Score (Desviación)</label><input type="number" id="z1" value="2" step="0.1" oninput="calcAll()"></div>
        <div class="result-box" id="out1"></div>
    </div>

    <div id="risk" class="tab-content">
        <div class="input-group"><label>Strike Dual que ofrece Binance (USD)</label><input type="number" id="stk2" value="2600" oninput="calcAll()"></div>
        <div class="input-group"><label>APR del Dual (%)</label><input type="number" id="apr2" value="12" oninput="calcAll()"></div>
        <div class="input-group"><label>APY Staking Líquido (Ether.fi/Lido %)</label><input type="number" id="apy_staking" value="2.97" oninput="calcAll()"></div>
        <div id="out2"></div>
    </div>
</div>

<script>
function normalCDF(z) {
    const t = 1 / (1 + 0.2316419 * Math.abs(z));
    const d = 0.3989423 * Math.exp(-z * z / 2);
    let p = d * t * (0.3193815 + t * (-0.3565638 + t * (1.781478 + t * (-1.821256 + t * 1.330274))));
    return z >= 0 ? 1 - p : p;
}

// Función para sincronizar inputs
function syncValues(input, type) {
    const val = input.value;
    document.querySelectorAll('.sync-' + type).forEach(el => el.value = val);
    calcAll();
}

function openTab(name) {
    document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.getElementById(name).classList.add('active');
    event.currentTarget.classList.add('active');
    calcAll();
}

function calcAll() {
    // Obtener valores comunes
    const S = parseFloat(document.querySelector('.sync-s').value);
    const IV = parseFloat(document.querySelector('.sync-iv').value)/100;
    const DTE = parseFloat(document.querySelector('.sync-dte').value);
    const T = DTE/365;

    if (isNaN(S) || isNaN(IV) || isNaN(DTE)) return;

    // Lógica Tab 1
    const Z = parseFloat(document.getElementById('z1').value);
    const mov = S * Z * IV * Math.sqrt(T);
    const prob1 = (normalCDF(Z) * 100).toFixed(2);
    document.getElementById('out1').innerHTML = `
        Venta Alta: <span class="highlight">$${(S+mov).toLocaleString(undefined, {minimumFractionDigits: 2})}</span> 
        Compra Baja: <span class="highlight">$${(S-mov).toLocaleString(undefined, {minimumFractionDigits: 2})}</span> 
        Prob. Éxito: ${prob1}%`;

    // Lógica Tab 2
    const K = parseFloat(document.getElementById('stk2').value);
    const APR = parseFloat(document.getElementById('apr2').value);
    const APY_S = parseFloat(document.getElementById('apy_staking').value);

    const zManual = Math.abs(Math.log(K/S) / (IV * Math.sqrt(T)));
    const probNoConv = (normalCDF(zManual) * 100).toFixed(2);
    
    let colorClass = 'badge-red', msg = 'Riesgo de Conversión Alto';

    if (probNoConv >= 95) {
        if (APR > (APY_S * 1.5)) {
            colorClass = 'badge-green';
            msg = 'Excelente Costo/Beneficio (Ganas >50% más que Staking)';
        } else {
            colorClass = 'badge-yellow';
            msg = 'Conservador (Seguro pero paga poco más que Staking)';
        }
    } else if (probNoConv >= 92) {
        colorClass = 'badge-yellow';
        msg = 'Aceptable (Conversión rara, 3-4 veces al año)';
    } else {
        colorClass = 'badge-red';
        msg = 'Peligro: Probabilidad de pérdida de ETH alta';
    }

    document.getElementById('out2').innerHTML = `
        <div class="result-box">
            Prob. Éxito (No Conv.): <span class="highlight">${probNoConv}%</span>
            Ventaja vs Staking: <b>+${(APR - APY_S).toFixed(2)}%</b>
            <div class="badge ${colorClass}">${msg}</div>
        </div>
    `;
}

// Inicializar
calcAll();
</script>
</body>
</html>
